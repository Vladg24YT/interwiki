{
  "version": 3,
  "sources": ["../js/createResizeIframe.js", "../js/lookup/crom.js", "../js/links.js", "../js/styles.js", "../js/branches-info-scp.js", "../js/branches-info-wl.js", "../js/interwiki.js"],
  "sourcesContent": ["/**\n * Whether the interwiki should be visible. It should only be visible after\n * data has been received from the API source.\n */\nvar showInterwiki = false;\n\n/**\n * Constructs and returns a function that, when called, resizes the current\n * iframes to match its contents. The function is debounced.\n *\n * @param {String} site - The base URL of the site.\n * @param {String} frameId - The last segment of the URL of the interwiki\n * iframe, used by Wikidot to identify it when resizing it.\n */\nexport function createResizeIframe(site, frameId) {\n  var container = document.getElementById(\"resizer-container\");\n  var resizer = document.createElement(\"iframe\");\n  resizer.style.display = \"none\";\n  container.appendChild(resizer);\n\n  if (frameId[0] !== \"/\") frameId = \"/\" + frameId;\n\n  return debounce(function (receivedData) {\n    if (receivedData) showInterwiki = true;\n    if (showInterwiki) {\n      // Measure from the top of the document to the iframe container to get\n      // the document height - this takes into account inner margins, unlike\n      // e.g. document.body.clientHeight\n      // The container must not have display:none for this to work, which is\n      // why the iframe has it instead\n      var height = container.getBoundingClientRect().top;\n      var cacheBreak = String(Math.floor(Math.random() * 10000));\n      resizer.src =\n        site +\n        \"/common--javascript/resize-iframe.html?\" +\n        cacheBreak +\n        \"#\" +\n        height +\n        frameId;\n    }\n  }, 250);\n}\n\n/**\n * Debounces a function, delaying its execution until a certain amount of\n * time has passed since the last time it was called, and aggregating all\n * calls made in that time into one.\n *\n * @param {Function} func - The function to call.\n * @param {Number} wait - The number of milliseconds to wait after any call\n * to the debounced function before executing it.\n */\nfunction debounce(func, wait) {\n  var timeout = 0;\n  return function () {\n    clearTimeout(timeout);\n    timeout = setTimeout(function () {\n      func(arguments);\n    }, wait);\n  };\n}\n", "// GraphQL query for Crom API\nvar query =\n  \" \\\n  query InterwikiQuery($url: URL!) { \\\n    page(url: $url) { \\\n      translations { \\\n        url \\\n      } \\\n      translationOf { \\\n        url \\\n        translations { \\\n          url \\\n        } \\\n      } \\\n    } \\\n  } \\\n\";\n\n/**\n * @typedef CromPage\n * @type {Object}\n * @property {String} url - The URL of this page.\n */\n\n/**\n * @typedef CromOriginalPage\n * @type {Object}\n * @property {String} url - The URL of this page.\n * @property {Array.<CromPage>} translations - URLs for translations of\n * this page.\n */\n\n/**\n * @typedef CromTranslations\n *\n * Crom's response to a translations request.\n *\n * Generally, either `translations` will be an empty array, or\n * `translationOf` will be null.\n *\n * @type {Object}\n * @property {Array.<CromPage>} translations - URLs for translations of\n * this page.\n * @property {?CromOriginalPage} translationOf - The page that the current\n * page is a translation of.\n */\n\n/**\n * Searches for pages whose fullname matches the given string in the given\n * set of Wikidot sites using Wikidot's PageLookupQModule.\n *\n * @param {Branch} currentBranch - Configuration for the current branch.\n * @param {Object.<string, Branch>} branches - The branches configuration\n * for the current community. All passed branches will be searched for the\n * target page.\n * @param {String} fullname - The fullname of the target page.\n * @param {addLinkCallback} addLink - A function that will be called for\n * each found translation.\n */\nexport function cromLookup(currentBranch, branches, fullname, addLink) {\n  executeQuery(normaliseUrl(currentBranch.url + fullname), function (response) {\n    parseTranslations(response, currentBranch, branches, addLink);\n  });\n}\n\n/**\n * Normalises a branch URL to one accepted by Crom.\n *\n * @param {String} url\n */\nfunction normaliseUrl(url) {\n  if (url.indexOf(\".wikidot.com\") === -1) {\n    throw new Error(\"Crom requires wikidot.com branch URLs (\" + url + \")\");\n  }\n  return url.replace(/^https:/, \"http:\");\n}\n\n/**\n * Parses the response from the Crom API into a list of translations.\n *\n * @param {CromTranslations} response - The response from the Crom API.\n * @param {Branch} currentBranch - Configuration for the current branch.\n * @param {Object.<string, Branch>} branches - The branches configuration\n * for the current community. All passed branches will be searched for the\n * target page.\n * @param {addLinkCallback} addLink - A function that will be\n * called for each found translation.\n */\nfunction parseTranslations(response, currentBranch, branches, addLink) {\n  function url(page) {\n    return page.url;\n  }\n  var original = null;\n  var translations = [];\n\n  // Extract translations of this page\n  translations = translations.concat(response.translations.map(url));\n  // Extract translations of this page's translation root\n  if (response.translationOf) {\n    original = response.translationOf.url;\n    translations.push(original);\n    translations = translations.concat(\n      response.translationOf.translations.map(url)\n    );\n  }\n\n  translations.forEach(function (translation) {\n    // Do not add this translation if it is from the current branch\n    var fromCurrentBranch =\n      translation.indexOf(normaliseUrl(currentBranch.url)) === 0;\n    if (fromCurrentBranch) return;\n\n    var targetBranchLang = Object.keys(branches).find(function (branchLang) {\n      return translation.indexOf(normaliseUrl(branches[branchLang].url)) === 0;\n    });\n    if (!targetBranchLang) {\n      // Crom may support unofficial/unconfigured branches\n      console.warn(\"Interwiki: unknown branch \" + translation);\n      return;\n    }\n\n    addLink(\n      translation,\n      branches[targetBranchLang].name,\n      targetBranchLang,\n      original === translation\n    );\n  });\n}\n\n/**\n * Queries the Crom API for translations of the given page.\n *\n * @param {String} url - The HTTP Wikidot URL of the page for which to look\n * up translations.\n * @param {Function} callback - Will be called with the response from Crom.\n */\nfunction executeQuery(url, callback) {\n  var request = new XMLHttpRequest();\n  request.open(\"POST\", \"https://api.crom.avn.sh/graphql\", true);\n  request.setRequestHeader(\"Content-Type\", \"application/json\");\n  request.addEventListener(\"readystatechange\", function () {\n    if (request.readyState === XMLHttpRequest.DONE) {\n      try {\n        if (request.status === 200) {\n          var response = JSON.parse(request.responseText);\n          if (response.errors && response.errors.length > 0) {\n            throw new Error(response.errors);\n          }\n          callback(response.data.page);\n        } else {\n          throw new Error(request.status);\n        }\n      } catch (error) {\n        console.error(\"Interwiki: lookup failed for \" + url);\n        console.error(error);\n      }\n    }\n  });\n  request.send(JSON.stringify({ query: query, variables: { url: url } }));\n}\n", "import { cromLookup } from \"./lookup/crom\";\n\n// Configure which lookup method is currently active\nvar lookupMethod = cromLookup;\n\n/**\n * @callback addLinkCallback\n * @param {String} pageUrl\n * @param {String} branchName\n * @param {String} branchLang\n * @param {Boolean} isOriginal\n */\n\n/**\n * @typedef Branch\n *\n * Configuration for a single branch.\n *\n * A branch is usually a whole Wikidot site but can be restricted to a\n * single category of a Wikidot site.\n *\n * @type {Object}\n * @property {String} name - The official name of the branch.\n * @property {String} head - The text of the header that will appear at the\n * top of the Interwiki.\n * @property {String} url - The URL of the site that contains this branch,\n * with a trailing slash.\n * @property {String} id - The numeric Wikidot site ID of the site that\n * contains this branch.\n * @property {String} category - The category within this site that\n * contains the branch, with a trailing colon; or, if the branch is not\n * contained to any category within the site, the empty string.\n */\n\n/**\n * Requests translation data for the current page from all configured\n * branches. Also sets the hover information in the refresh link to the\n * current time.\n *\n * @param {Object.<string, Branch>} branches - The branches configuration\n * for the current community.\n * @param {String} currentBranchLang - The language code of the current\n * branch, as defined in the community's branches config.\n * @param {String} pagename - The fullname of the page in the current\n * branch to find translations for.\n * @param {Function} resize - A callback to resize the iframe after adding\n * a new translation.\n */\nexport function addTranslations(branches, currentBranchLang, pagename, resize) {\n  // Get the config for the current branch, if configured\n  var currentBranch = branches[currentBranchLang] || {};\n\n  // Hide the side block by default (will be unhidden if there is at least\n  // one translation)\n  var sideBlock = document.getElementsByClassName(\"side-block\")[0];\n  sideBlock.style.display = \"none\";\n\n  // Construct the header\n  var header = document.querySelector(\".heading p\");\n  header.innerText = currentBranch.head;\n\n  lookupMethod(\n    currentBranch,\n    branches,\n    pagename,\n    function (pageUrl, branchName, branchLang, isOriginal) {\n      addTranslationLink(pageUrl, branchName, branchLang, isOriginal);\n      // Resize the iframe to account for the new link and indicate that\n      // data has been received\n      resize(true);\n    }\n  );\n}\n\n/**\n * Create a new menu item, containing a link to a page in a given branch,\n * and append it to the side block.\n *\n * @param {String} pageUrl - The URL of the translation to link to.\n * @param {String} branchName - The name of the branch.\n * @param {String} branchLang - The language code of the branch.\n * @param {Boolean} isOriginal - Whether this link is for the original\n * article rather than a translation.\n */\nfunction addTranslationLink(pageUrl, branchName, branchLang, isOriginal) {\n  var sideBlock = document.getElementsByClassName(\"side-block\")[0];\n  var menuItems = Array.prototype.slice.call(\n    sideBlock.getElementsByClassName(\"menu-item\")\n  );\n\n  // There is a translation, so unhide the side block if it is hidden\n  sideBlock.style.display = \"\";\n\n  // Create the new menu item\n  var newMenuItem = document.createElement(\"div\");\n  newMenuItem.classList.add(\"menu-item\");\n  if (isOriginal) newMenuItem.classList.add(\"original\");\n  // Record its branch's language code in the element\n  newMenuItem.setAttribute(\"name\", branchLang);\n\n  // Create the bullet point image\n  var bullet = document.createElement(\"img\");\n  bullet.setAttribute(\n    \"src\",\n    \"//scp-wiki.wdfiles.com/local--files/nav:side/default.png\"\n  );\n  bullet.setAttribute(\"alt\", \"default.png\");\n  bullet.classList.add(\"image\");\n  newMenuItem.appendChild(bullet);\n\n  // Create the actual link\n  var link = document.createElement(\"a\");\n  link.setAttribute(\"href\", pageUrl);\n  link.setAttribute(\"target\", \"_parent\");\n  link.innerText = branchName;\n  newMenuItem.appendChild(link);\n\n  // Add the new menu item to the end of the side block by default\n  sideBlock.appendChild(newMenuItem);\n  // Then find the first existing menu item whose lang code is\n  // alphabetically greater than the new item, and move the new item to\n  // just before it\n  menuItems.some(function (menuItem) {\n    if (menuItem.getAttribute(\"name\") > branchLang) {\n      sideBlock.insertBefore(newMenuItem, menuItem);\n      return true;\n    }\n  });\n}\n", "import { getQueryString } from \"./interwiki\";\n\n/**\n * Constructs the handler for requesting style changes to the\n * interwikiFrame.\n *\n * @param {String} siteUrl - The base URL of the interwiki's configured\n * site.\n * @param {Function} resize - A function to call to resize the interwiki\n * iframe after adding new CSS.\n */\nexport function createRequestStyleChange(siteUrl, resize) {\n  /**\n   * Handles a style request from a styleFrame.\n   *\n   * @param {String} request - A URL query originating from a styleFrame,\n   * requesting a style change for the interwikiFrame.\n   */\n  return function requestStyleChange(request) {\n    var priorityRaw = getQueryString(request, \"priority\");\n    var priority = Number(priorityRaw);\n    if (isNaN(priority)) {\n      console.error(\"Interwiki: rejected style with priority\" + priorityRaw);\n      return;\n    }\n\n    var theme = getQueryString(request, \"theme\");\n    if (theme) addExternalStyle(priority, urlFromTheme(siteUrl, theme), resize);\n\n    var css = getQueryString(request, \"css\");\n    if (css) addInternalStyle(priority, css, resize);\n  };\n}\n\n/**\n * Creates a new style element in the document containing the given CSS.\n *\n * @param {Number} priority - The priority of the CSS, which determines the\n * sort order.\n * @param {String} css - Raw CSS to add to the style.\n * @param {Function} resize - Callback to resize the iframe after applying\n * the style.\n */\nfunction addInternalStyle(priority, css, resize) {\n  // Check that the incoming CSS doesn't duplicate an existing style\n  var styleElements = Array.prototype.slice.call(\n    document.head.querySelectorAll(\"style.custom-style\")\n  );\n  if (styleElements.some(duplicatesStyle(priority, css))) return;\n\n  // Create a new style elements for the CSS\n  var style = document.createElement(\"style\");\n  style.innerText = css;\n\n  // Insert the style into the appropriate position in the head\n  insertStyle(priority, style);\n\n  // There is no reliable way to detect when the style has been applied to\n  // the document, so wait a tick before resizing the iframe\n  setTimeout(resize, 250);\n}\n\n/**\n * Creates a new link element in the document referencing the CSS\n * stylesheet at the given URL.\n *\n * @param {Number} priority - The priority of the CSS, which determines the\n * sort order.\n * @param {String} url - The URL of the CSS stylesheet.\n * @param {Function} resize - Callback to resize the iframe after applying\n * the style.\n */\nexport function addExternalStyle(priority, url, resize) {\n  // Check that the incoming link doesn't duplicate an existing style\n  var linkElements = Array.prototype.slice.call(\n    document.head.querySelectorAll(\"link.custom-style\")\n  );\n  if (linkElements.some(duplicatesStyle(priority, url))) return;\n\n  // Create a new link element for the stylesheet\n  var link = document.createElement(\"link\");\n  link.rel = \"stylesheet\";\n\n  // There is no way to detect when the style from the stylesheet has been\n  // applied to the document - best that can be done is to wait a tick\n  // after the stylesheet has been retrieved\n  link.addEventListener(\"load\", resize);\n  link.href = url;\n\n  // Insert the link into the appropriate position in the head\n  insertStyle(priority, link);\n}\n\n/**\n * Inserts the given styling element into the document head, in a position\n * relative to pre-existing styling elements determined by the priority key\n * of its dataset. Elements with greater priority are placed below those\n * with lower priorities.\n *\n * @param {Number} newPriority - The priority of this element.\n * @param {HTMLinkElement | HTMLStyleElement} newStylingElement - The element\n * to insert.\n */\nfunction insertStyle(newPriority, newStylingElement) {\n  newStylingElement.classList.add(\"custom-style\");\n  newStylingElement.dataset.priority = newPriority;\n  var stylingElements = Array.prototype.slice.call(\n    document.head.querySelectorAll(\"link.custom-style, style.custom-style\")\n  );\n\n  // Attempt to insert the element between other existing elements\n  var newTagName = newStylingElement.tagName;\n  var wasInserted = stylingElements.some(function (stylingElement) {\n    var priority = Number(stylingElement.dataset.priority);\n    var tagName = stylingElement.tagName;\n\n    // If the new priority is more than the current priority, continue\n    if (newPriority > priority) return false;\n\n    // If the two priorities are equal...\n    if (priority === newPriority) {\n      // Two styles are not supposed to have the same priority, but a\n      // single link and style with the same priority is allowed. In this\n      // case the style has slightly higher priority than the link\n      if (tagName === \"LINK\" && newTagName === \"STYLE\") {\n        // The style is allowed to be inserted after the link, so continue\n        return false;\n      }\n\n      if (tagName === newTagName) {\n        // Two elements of the same tag with the same priority are not\n        // allowed - raise a warning about it, but add them anyway\n        console.error(\n          \"Interwiki: encountered two \" +\n            (tagName === \"LINK\" ? \"themes\" : \"CSS styles\") +\n            \" with the same priority (\" +\n            priority +\n            \") - result may not be as expected\"\n        );\n        // Fall back to insertion\n      }\n\n      // Otherwise (if old is STYLE and new is LINK, or if they are equal),\n      // fall back to insertion\n    }\n\n    // Otherwise, if the new priority is less than the current priority (or\n    // after falling back from the equality case), insert the new element\n    // before the one with higher priority\n    document.head.insertBefore(newStylingElement, stylingElement);\n    return true;\n  });\n\n  if (!wasInserted) {\n    // The element would not have been inserted if it is the first, or if\n    // its priority is greater than all existing priorities\n    document.head.appendChild(newStylingElement);\n  }\n}\n\n/**\n * Constructs and returns a function that checks if a given HTML element\n * (assumed to be either a link or a style element) is a match for an\n * element that would have been created for the given priority and value.\n *\n * @param {Number} priority\n * @param {String} value\n */\nfunction duplicatesStyle(priority, value) {\n  /**\n   * @param {HTMLLinkElement | HTMLStyleElement} styleElement\n   * @returns {Boolean}\n   */\n  var isDuplicate = function (styleElement) {\n    if (Number(styleElement.getAttribute(\"data-priority\")) !== priority) {\n      return false;\n    }\n    if (styleElement.tagName === \"LINK\") {\n      return styleElement.getAttribute(\"href\") === value;\n    }\n    if (styleElement.tagName === \"STYLE\") {\n      return styleElement.innerText === value;\n    }\n    return false;\n  };\n  return isDuplicate;\n}\n\n/**\n * Constructs a URL pointing to the expected location of a CSS stylesheet.\n *\n * The theme pointer may be one of the following:\n * - A full URL to a CSS stylesheet.\n * - The fullname of a page on the current wiki, whose /code/1 endpoint\n *   will be parsed as a CSS stylesheet.\n * - The fullname of a page on the current wiki specifying a code block\n *   number (of the form <fullname>/code/n), where the nth code block on\n *   that page will be parsed as a CSS stylesheet.\n *\n * @param {String} siteUrl - The base URL of the site matching the\n * interwikiFrame's language code, which will be used to look up the theme\n * the case that a full URL was not provided.\n * @param {String} theme - An indicator of where a CSS stylesheet can be\n * found.\n */\nfunction urlFromTheme(siteUrl, theme) {\n  // If the theme is already a full URL, return it\n  if (theme.indexOf(\"http\") === 0 || theme.indexOf(\"//\") === 0) {\n    return theme;\n  }\n\n  // If the interwiki's site URL is not known, the full URL for a relative\n  // theme cannot be constructed\n  if (!siteUrl) {\n    console.error(\n      \"Interwiki: could not resolve relative fullname (\" +\n        theme +\n        \") for unconfigured site. Consider using a full URL instead.\"\n    );\n    return \"\";\n  }\n\n  // Assume it's a fullname\n  if (theme.indexOf(\"/\") === -1) {\n    return siteUrl + \"/local--code/\" + theme + \"/1\";\n  }\n  // Assume of the form <fullname>/code/1\n  var themeParts = theme.split(\"/\");\n  if (themeParts.length >= 3 && themeParts[1] === \"code\") {\n    return siteUrl + \"/local--code/\" + themeParts[0] + \"/\" + themeParts[2];\n  }\n  // If none of those worked, report the error\n  console.error(\"Interwiki: unknown theme location:\" + theme);\n  return \"\";\n}\n", "export var scpBranches = {\n  cn: {\n    name: \"\u4E2D\u6587\",\n    head: \"\u5176\u4ED6\u8BED\u8A00\",\n    url: \"https://scp-wiki-cn.wikidot.com/\",\n    id: \"530812\",\n    category: \"\",\n  },\n  cs: {\n    name: \"\u010Cesky\",\n    head: \"V jin\u00FDch jazyc\u00EDch\",\n    url: \"https://scp-cs.wikidot.com/\",\n    id: \"2060442\",\n    category: \"\",\n  },\n  en: {\n    name: \"English\",\n    head: \"In other languages\",\n    url: \"https://scp-wiki.wikidot.com/\",\n    id: \"66711\",\n    category: \"\",\n  },\n  fr: {\n    name: \"Fran\u00E7ais\",\n    head: \"Dans d\u2019autres langues\",\n    url: \"https://fondationscp.wikidot.com/\",\n    id: \"464696\",\n    category: \"\",\n  },\n  de: {\n    name: \"Deutsch\",\n    head: \"In anderen Sprachen\",\n    url: \"https://scp-wiki-de.wikidot.com/\",\n    id: \"1269857\",\n    category: \"\",\n  },\n  int: {\n    name: \"International\",\n    head: \"Languages\",\n    url: \"https://scp-int.wikidot.com/\",\n    id: \"1427610\",\n    category: \"\",\n  },\n  it: {\n    name: \"Italiano\",\n    head: \"In altre lingue\",\n    url: \"https://fondazionescp.wikidot.com/\",\n    id: \"530167\",\n    category: \"\",\n  },\n  jp: {\n    name: \"\u65E5\u672C\u8A9E\",\n    head: \"\u4ED6\u8A00\u8A9E\u7248\",\n    url: \"https://scp-jp.wikidot.com/\",\n    id: \"578002\",\n    category: \"\",\n  },\n  ko: {\n    name: \"\uD55C\uAD6D\uC5B4\",\n    head: \"\uB2E4\uB978 \uC5B8\uC5B4\",\n    url: \"http://scpko.wikidot.com/\",\n    id: \"486864\",\n    category: \"\",\n  },\n  pl: {\n    name: \"Polski\",\n    head: \"W innych j\u0119zykach\",\n    url: \"http://scp-pl.wikidot.com/\",\n    id: \"647733\",\n    category: \"\",\n  },\n  ptbr: {\n    name: \"Portugu\u00EAs\",\n    head: \"Em outros idiomas\",\n    url: \"https://scp-pt-br.wikidot.com/\",\n    id: \"783633\",\n    category: \"\",\n  },\n  ru: {\n    name: \"\u0420\u0443\u0441\u0441\u043A\u0438\u0439\",\n    head: \"\u041D\u0430 \u0434\u0440\u0443\u0433\u0438\u0445 \u044F\u0437\u044B\u043A\u0430\u0445\",\n    url: \"http://scp-ru.wikidot.com/\",\n    id: \"169125\",\n    category: \"\",\n  },\n  es: {\n    name: \"Espa\u00F1ol\",\n    head: \"En otros idiomas\",\n    url: \"http://lafundacionscp.wikidot.com/\",\n    id: \"560484\",\n    category: \"\",\n  },\n  th: {\n    name: \"\u0E20\u0E32\u0E29\u0E32\u0E44\u0E17\u0E22\",\n    head: \"\u0E20\u0E32\u0E29\u0E32\u0E2D\u0E37\u0E48\u0E19\",\n    url: \"https://scp-th.wikidot.com/\",\n    id: \"547203\",\n    category: \"\",\n  },\n  ua: {\n    name: \"\u0423\u043A\u0440\u0430\u0457\u043D\u0441\u044C\u043A\u0430\",\n    head: \"\u0406\u043D\u0448\u0438\u043C\u0438 \u043C\u043E\u0432\u0430\u043C\u0438\",\n    url: \"https://scp-ukrainian.wikidot.com/\",\n    id: \"1398197\",\n    category: \"\",\n  },\n  \"zh-tr\": {\n    name: \"\u7E41\u9AD4\u4E2D\u6587\",\n    head: \"\u5176\u4ED6\u8A9E\u8A00\",\n    url: \"https://scp-zh-tr.wikidot.com/\",\n    id: \"3947998\",\n    category: \"\",\n  },\n  vn: {\n    name: \"Ti\u1EBFng Vi\u1EC7t\",\n    head: \"Ng\u00F4n ng\u1EEF\",\n    url: \"https://scp-vn.wikidot.com/\",\n    id: \"836589\",\n    category: \"\",\n  },\n};\n", "export var wlBranches = {\n  cn: {\n    name: \"\u4E2D\u6587\",\n    head: \"\u5176\u4ED6\u8BED\u8A00\",\n    url: \"https://scp-wiki-cn.wikidot.com/\",\n    id: \"530812\",\n    category: \"wanderers:\",\n  },\n  cs: {\n    name: \"\u010Ce\u0161tina\",\n    head: \"V jin\u00FDch jazyc\u00EDch\",\n    url: \"https://wanderers-library-cs.wikidot.com/\",\n    id: \"4600566\",\n    category: \"\",\n  },\n  en: {\n    name: \"English\",\n    head: \"Languages\",\n    url: \"https://wanderers-library.wikidot.com/\",\n    id: \"146034\",\n    category: \"\",\n  },\n  jp: {\n    name: \"\u65E5\u672C\u8A9E\",\n    head: \"\u4ED6\u8A00\u8A9E\u7248\",\n    url: \"https://wanderers-library-jp.wikidot.com/\",\n    id: \"4600658\",\n    category: \"\",\n  },\n  ko: {\n    name: \"\uD55C\uAD6D\uC5B4\",\n    head: \"\uB2E4\uB978 \uC5B8\uC5B4\",\n    url: \"https://wanderers-library-ko.wikidot.com/\",\n    id: \"621849\",\n    category: \"\",\n  },\n  pl: {\n    name: \"Polski\",\n    head: \"W innych j\u0119zykach\",\n    url: \"https://wanderers-library-pl.wikidot.com/\",\n    id: \"4593099\",\n    category: \"\",\n  },\n};\n", "import { createResizeIframe } from \"./createResizeIframe\";\nimport { addTranslations } from \"./links\";\nimport { addExternalStyle, createRequestStyleChange } from \"./styles\";\n\nimport { scpBranches } from \"./branches-info-scp\";\nimport { wlBranches } from \"./branches-info-wl\";\n\naddEventListener(\"DOMContentLoaded\", function () {\n  var community = getQueryString(location.search, \"community\");\n  var pagename = getQueryString(location.search, \"pagename\");\n  var lang = getQueryString(location.search, \"lang\");\n  var preventWikidotBaseStyle = getQueryString(\n    location.search,\n    \"preventWikidotBaseStyle\"\n  );\n\n  createInterwiki(community, pagename, lang, preventWikidotBaseStyle);\n\n  // Expose identity for styleFrame\n  window.isInterwikiFrame = true;\n});\n\n/**\n * Retrieves the value of the query parameter in the URL with the\n * given key, if provided, otherwise returns the empty string.\n *\n * @param {String} query - The URL query.\n * @param {String} name - The name of the parameter to get.\n */\nexport function getQueryString(query, name) {\n  // Get query parameters from the URL\n  if (query.indexOf(\"?\") === 0) query = query.substring(1);\n  var parameters = query.split(\"&\");\n  // Iterate parameters in reverse so later values override earlier ones\n  parameters.reverse();\n  // Find the parameter whose key is the given name\n  var matchingParameter = parameters.find(function (parameter) {\n    return parameter.indexOf(name + \"=\") === 0;\n  });\n  if (matchingParameter == null) return \"\";\n  // Return the part of the parameter following the \"=\"\n  return decodeURIComponent(matchingParameter.substring(name.length + 1));\n}\n\n/**\n * Finds styleFrames embedded in the parent page and pulls their style\n * change requests for the interwikiFrame to use.\n *\n * styleFrames will also attempt to push their styles to the\n * interwikiFrame. The two methods work in unison to ensure that the\n * interwikiFrame receives all styles regardless of what order the iframes\n * initialise in.\n *\n * This function is also called on window reload prompted by the\n * interwiki's click-to-refresh, at which point it is very likely that all\n * styleFrames will have finished initialising.\n */\nfunction pullStyles() {\n  // Find styleFrames in the parent that have initialised before this\n  // interwikiFrame did, and pull their query parameters\n  Array.prototype.slice.call(parent).forEach(function (frame) {\n    try {\n      if (frame.isStyleFrame) {\n        window.requestStyleChange(frame.location.search);\n      }\n    } catch (error) {\n      // styleFrames that have not finished initialising will push their\n      // styles to the interwikiFrame when they are ready\n      if (!(error instanceof DOMException)) {\n        // All other errors must be reported\n        throw error;\n      }\n    }\n  });\n}\n\n/**\n * Main procedure for the interwiki. Prepare contextual data, apply CSS\n * styling, and add links to translations.\n *\n * @param {\"scp\" | \"wl\"} community - The community of the interwiki.\n * @param {String} pagename - The Wikidot fullname of the current page.\n * @param {String} currentBranchLang - The language code of the current branch\n * of the given community.\n * @param {String} preventWikidotBaseStyle - Whether to prevent the\n * addition of Wikidot's base style to the interwiki. If any value other\n * than the string \"true\", the style will be added with priority -1.\n */\nexport function createInterwiki(\n  community,\n  pagename,\n  currentBranchLang,\n  preventWikidotBaseStyle\n) {\n  pagename = pagename.replace(/^_default:/, \"\");\n\n  // Get the list of branches for the given community\n  var branches = { wl: wlBranches, scp: scpBranches }[community] || {};\n\n  // Get the config for the current branch, if configured\n  var currentBranch = branches[currentBranchLang] || {};\n\n  // Construct the function that will resize the frame after changes\n  var site = document.referrer;\n  var frameId = location.href.replace(/^.*\\//, \"/\");\n  var resize = createResizeIframe(site, frameId);\n\n  // Construct the function that will be called internally and by\n  // styleFrames to request style changes\n  window.requestStyleChange = createRequestStyleChange(\n    currentBranch.url || \"\",\n    resize\n  );\n\n  // Add Wikidot's base style unless instructed otherwise\n  if (preventWikidotBaseStyle !== \"true\") {\n    addExternalStyle(\n      -1,\n      \"//d3g0gp89917ko0.cloudfront.net/v--3e3a6f7dbcc9/common--theme/base/css/style.css\"\n    );\n  }\n\n  pullStyles();\n  addTranslations(branches, currentBranchLang, pagename, resize);\n}\n"],
  "mappings": "YAIA,GAAI,GAAgB,GAUb,WAA4B,EAAM,EAAS,CAChD,GAAI,GAAY,SAAS,eAAe,qBACpC,EAAU,SAAS,cAAc,UACrC,SAAQ,MAAM,QAAU,OACxB,EAAU,YAAY,GAElB,EAAQ,KAAO,KAAK,GAAU,IAAM,GAEjC,EAAS,SAAU,EAAc,CAEtC,GADI,GAAc,GAAgB,IAC9B,EAAe,CAMjB,GAAI,GAAS,EAAU,wBAAwB,IAC3C,EAAa,OAAO,KAAK,MAAM,KAAK,SAAW,MACnD,EAAQ,IACN,EACA,0CACA,EACA,IACA,EACA,IAEH,KAYL,WAAkB,EAAM,EAAM,CAC5B,GAAI,GAAU,EACd,MAAO,WAAY,CACjB,aAAa,GACb,EAAU,WAAW,UAAY,CAC/B,EAAK,YACJ,ICzDP,GAAI,GACF,2MAyDK,WAAoB,EAAe,EAAU,EAAU,EAAS,CACrE,EAAa,EAAa,EAAc,IAAM,GAAW,SAAU,EAAU,CAC3E,EAAkB,EAAU,EAAe,EAAU,KASzD,WAAsB,EAAK,CACzB,GAAI,EAAI,QAAQ,kBAAoB,GAClC,KAAM,IAAI,OAAM,0CAA4C,EAAM,KAEpE,MAAO,GAAI,QAAQ,UAAW,SAchC,WAA2B,EAAU,EAAe,EAAU,EAAS,CACrE,WAAa,EAAM,CACjB,MAAO,GAAK,IAEd,GAAI,GAAW,KACX,EAAe,GAGnB,EAAe,EAAa,OAAO,EAAS,aAAa,IAAI,IAEzD,EAAS,eACX,GAAW,EAAS,cAAc,IAClC,EAAa,KAAK,GAClB,EAAe,EAAa,OAC1B,EAAS,cAAc,aAAa,IAAI,KAI5C,EAAa,QAAQ,SAAU,EAAa,CAE1C,GAAI,GACF,EAAY,QAAQ,EAAa,EAAc,QAAU,EAC3D,GAAI,GAEJ,IAAI,GAAmB,OAAO,KAAK,GAAU,KAAK,SAAU,EAAY,CACtE,MAAO,GAAY,QAAQ,EAAa,EAAS,GAAY,QAAU,IAEzE,GAAI,CAAC,EAAkB,CAErB,QAAQ,KAAK,6BAA+B,GAC5C,OAGF,EACE,EACA,EAAS,GAAkB,KAC3B,EACA,IAAa,MAYnB,WAAsB,EAAK,EAAU,CACnC,GAAI,GAAU,GAAI,gBAClB,EAAQ,KAAK,OAAQ,kCAAmC,IACxD,EAAQ,iBAAiB,eAAgB,oBACzC,EAAQ,iBAAiB,mBAAoB,UAAY,CACvD,GAAI,EAAQ,aAAe,eAAe,KACxC,GAAI,CACF,GAAI,EAAQ,SAAW,IAAK,CAC1B,GAAI,GAAW,KAAK,MAAM,EAAQ,cAClC,GAAI,EAAS,QAAU,EAAS,OAAO,OAAS,EAC9C,KAAM,IAAI,OAAM,EAAS,QAE3B,EAAS,EAAS,KAAK,UAEvB,MAAM,IAAI,OAAM,EAAQ,cAEnB,EAAP,CACA,QAAQ,MAAM,gCAAkC,GAChD,QAAQ,MAAM,MAIpB,EAAQ,KAAK,KAAK,UAAU,CAAE,MAAO,EAAO,UAAW,CAAE,IAAK,MC5JhE,GAAI,GAAe,EA6CZ,WAAyB,EAAU,EAAmB,EAAU,EAAQ,CAE7E,GAAI,GAAgB,EAAS,IAAsB,GAI/C,EAAY,SAAS,uBAAuB,cAAc,GAC9D,EAAU,MAAM,QAAU,OAG1B,GAAI,GAAS,SAAS,cAAc,cACpC,EAAO,UAAY,EAAc,KAEjC,EACE,EACA,EACA,EACA,SAAU,EAAS,EAAY,EAAY,EAAY,CACrD,EAAmB,EAAS,EAAY,EAAY,GAGpD,EAAO,MAeb,WAA4B,EAAS,EAAY,EAAY,EAAY,CACvE,GAAI,GAAY,SAAS,uBAAuB,cAAc,GAC1D,EAAY,MAAM,UAAU,MAAM,KACpC,EAAU,uBAAuB,cAInC,EAAU,MAAM,QAAU,GAG1B,GAAI,GAAc,SAAS,cAAc,OACzC,EAAY,UAAU,IAAI,aACtB,GAAY,EAAY,UAAU,IAAI,YAE1C,EAAY,aAAa,OAAQ,GAGjC,GAAI,GAAS,SAAS,cAAc,OACpC,EAAO,aACL,MACA,4DAEF,EAAO,aAAa,MAAO,eAC3B,EAAO,UAAU,IAAI,SACrB,EAAY,YAAY,GAGxB,GAAI,GAAO,SAAS,cAAc,KAClC,EAAK,aAAa,OAAQ,GAC1B,EAAK,aAAa,SAAU,WAC5B,EAAK,UAAY,EACjB,EAAY,YAAY,GAGxB,EAAU,YAAY,GAItB,EAAU,KAAK,SAAU,EAAU,CACjC,GAAI,EAAS,aAAa,QAAU,EAClC,SAAU,aAAa,EAAa,GAC7B,KClHN,WAAkC,EAAS,EAAQ,CAOxD,MAAO,UAA4B,EAAS,CAC1C,GAAI,GAAc,EAAe,EAAS,YACtC,EAAW,OAAO,GACtB,GAAI,MAAM,GAAW,CACnB,QAAQ,MAAM,0CAA4C,GAC1D,OAGF,GAAI,GAAQ,EAAe,EAAS,SACpC,AAAI,GAAO,EAAiB,EAAU,EAAa,EAAS,GAAQ,GAEpE,GAAI,GAAM,EAAe,EAAS,OAClC,AAAI,GAAK,EAAiB,EAAU,EAAK,IAa7C,WAA0B,EAAU,EAAK,EAAQ,CAE/C,GAAI,GAAgB,MAAM,UAAU,MAAM,KACxC,SAAS,KAAK,iBAAiB,uBAEjC,GAAI,GAAc,KAAK,EAAgB,EAAU,IAGjD,IAAI,GAAQ,SAAS,cAAc,SACnC,EAAM,UAAY,EAGlB,EAAY,EAAU,GAItB,WAAW,EAAQ,MAad,WAA0B,EAAU,EAAK,EAAQ,CAEtD,GAAI,GAAe,MAAM,UAAU,MAAM,KACvC,SAAS,KAAK,iBAAiB,sBAEjC,GAAI,GAAa,KAAK,EAAgB,EAAU,IAGhD,IAAI,GAAO,SAAS,cAAc,QAClC,EAAK,IAAM,aAKX,EAAK,iBAAiB,OAAQ,GAC9B,EAAK,KAAO,EAGZ,EAAY,EAAU,IAaxB,WAAqB,EAAa,EAAmB,CACnD,EAAkB,UAAU,IAAI,gBAChC,EAAkB,QAAQ,SAAW,EACrC,GAAI,GAAkB,MAAM,UAAU,MAAM,KAC1C,SAAS,KAAK,iBAAiB,0CAI7B,EAAa,EAAkB,QAC/B,EAAc,EAAgB,KAAK,SAAU,EAAgB,CAC/D,GAAI,GAAW,OAAO,EAAe,QAAQ,UACzC,EAAU,EAAe,QAG7B,GAAI,EAAc,EAAU,MAAO,GAGnC,GAAI,IAAa,EAAa,CAI5B,GAAI,IAAY,QAAU,IAAe,QAEvC,MAAO,GAGT,AAAI,IAAY,GAGd,QAAQ,MACN,8BACG,KAAY,OAAS,SAAW,cACjC,4BACA,EACA,qCAYR,gBAAS,KAAK,aAAa,EAAmB,GACvC,KAGT,AAAK,GAGH,SAAS,KAAK,YAAY,GAY9B,WAAyB,EAAU,EAAO,CAKxC,GAAI,GAAc,SAAU,EAAc,CACxC,MAAI,QAAO,EAAa,aAAa,oBAAsB,EAClD,GAEL,EAAa,UAAY,OACpB,EAAa,aAAa,UAAY,EAE3C,EAAa,UAAY,QACpB,EAAa,YAAc,EAE7B,IAET,MAAO,GAoBT,WAAsB,EAAS,EAAO,CAEpC,GAAI,EAAM,QAAQ,UAAY,GAAK,EAAM,QAAQ,QAAU,EACzD,MAAO,GAKT,GAAI,CAAC,EACH,eAAQ,MACN,mDACE,EACA,+DAEG,GAIT,GAAI,EAAM,QAAQ,OAAS,GACzB,MAAO,GAAU,gBAAkB,EAAQ,KAG7C,GAAI,GAAa,EAAM,MAAM,KAC7B,MAAI,GAAW,QAAU,GAAK,EAAW,KAAO,OACvC,EAAU,gBAAkB,EAAW,GAAK,IAAM,EAAW,GAGtE,SAAQ,MAAM,qCAAuC,GAC9C,ICzOF,GAAI,GAAc,CACvB,GAAI,CACF,KAAM,eACN,KAAM,2BACN,IAAK,mCACL,GAAI,SACJ,SAAU,IAEZ,GAAI,CACF,KAAM,aACN,KAAM,0BACN,IAAK,8BACL,GAAI,UACJ,SAAU,IAEZ,GAAI,CACF,KAAM,UACN,KAAM,qBACN,IAAK,gCACL,GAAI,QACJ,SAAU,IAEZ,GAAI,CACF,KAAM,cACN,KAAM,6BACN,IAAK,oCACL,GAAI,SACJ,SAAU,IAEZ,GAAI,CACF,KAAM,UACN,KAAM,sBACN,IAAK,mCACL,GAAI,UACJ,SAAU,IAEZ,IAAK,CACH,KAAM,gBACN,KAAM,YACN,IAAK,+BACL,GAAI,UACJ,SAAU,IAEZ,GAAI,CACF,KAAM,WACN,KAAM,kBACN,IAAK,qCACL,GAAI,SACJ,SAAU,IAEZ,GAAI,CACF,KAAM,qBACN,KAAM,2BACN,IAAK,8BACL,GAAI,SACJ,SAAU,IAEZ,GAAI,CACF,KAAM,qBACN,KAAM,4BACN,IAAK,4BACL,GAAI,SACJ,SAAU,IAEZ,GAAI,CACF,KAAM,SACN,KAAM,yBACN,IAAK,6BACL,GAAI,SACJ,SAAU,IAEZ,KAAM,CACJ,KAAM,eACN,KAAM,oBACN,IAAK,iCACL,GAAI,SACJ,SAAU,IAEZ,GAAI,CACF,KAAM,6CACN,KAAM,yFACN,IAAK,6BACL,GAAI,SACJ,SAAU,IAEZ,GAAI,CACF,KAAM,aACN,KAAM,mBACN,IAAK,qCACL,GAAI,SACJ,SAAU,IAEZ,GAAI,CACF,KAAM,6CACN,KAAM,mDACN,IAAK,8BACL,GAAI,SACJ,SAAU,IAEZ,GAAI,CACF,KAAM,+DACN,KAAM,4EACN,IAAK,qCACL,GAAI,UACJ,SAAU,IAEZ,QAAS,CACP,KAAM,2BACN,KAAM,2BACN,IAAK,iCACL,GAAI,UACJ,SAAU,IAEZ,GAAI,CACF,KAAM,uBACN,KAAM,mBACN,IAAK,8BACL,GAAI,SACJ,SAAU,KCtHP,GAAI,GAAa,CACtB,GAAI,CACF,KAAM,eACN,KAAM,2BACN,IAAK,mCACL,GAAI,SACJ,SAAU,cAEZ,GAAI,CACF,KAAM,oBACN,KAAM,0BACN,IAAK,4CACL,GAAI,UACJ,SAAU,IAEZ,GAAI,CACF,KAAM,UACN,KAAM,YACN,IAAK,yCACL,GAAI,SACJ,SAAU,IAEZ,GAAI,CACF,KAAM,qBACN,KAAM,2BACN,IAAK,4CACL,GAAI,UACJ,SAAU,IAEZ,GAAI,CACF,KAAM,qBACN,KAAM,4BACN,IAAK,4CACL,GAAI,SACJ,SAAU,IAEZ,GAAI,CACF,KAAM,SACN,KAAM,yBACN,IAAK,4CACL,GAAI,UACJ,SAAU,KClCd,iBAAiB,mBAAoB,UAAY,CAC/C,GAAI,GAAY,EAAe,SAAS,OAAQ,aAC5C,EAAW,EAAe,SAAS,OAAQ,YAC3C,EAAO,EAAe,SAAS,OAAQ,QACvC,EAA0B,EAC5B,SAAS,OACT,2BAGF,EAAgB,EAAW,EAAU,EAAM,GAG3C,OAAO,iBAAmB,KAUrB,WAAwB,EAAO,EAAM,CAE1C,AAAI,EAAM,QAAQ,OAAS,GAAG,GAAQ,EAAM,UAAU,IACtD,GAAI,GAAa,EAAM,MAAM,KAE7B,EAAW,UAEX,GAAI,GAAoB,EAAW,KAAK,SAAU,EAAW,CAC3D,MAAO,GAAU,QAAQ,EAAO,OAAS,IAE3C,MAAI,IAAqB,KAAa,GAE/B,mBAAmB,EAAkB,UAAU,EAAK,OAAS,IAgBtE,YAAsB,CAGpB,MAAM,UAAU,MAAM,KAAK,QAAQ,QAAQ,SAAU,EAAO,CAC1D,GAAI,CACF,AAAI,EAAM,cACR,OAAO,mBAAmB,EAAM,SAAS,cAEpC,EAAP,CAGA,GAAI,CAAE,aAAiB,eAErB,KAAM,MAkBP,WACL,EACA,EACA,EACA,EACA,CACA,EAAW,EAAS,QAAQ,aAAc,IAG1C,GAAI,GAAW,CAAE,GAAI,EAAY,IAAK,GAAc,IAAc,GAG9D,EAAgB,EAAS,IAAsB,GAG/C,EAAO,SAAS,SAChB,EAAU,SAAS,KAAK,QAAQ,QAAS,KACzC,EAAS,EAAmB,EAAM,GAItC,OAAO,mBAAqB,EAC1B,EAAc,KAAO,GACrB,GAIE,IAA4B,QAC9B,EACE,GACA,oFAIJ,IACA,EAAgB,EAAU,EAAmB,EAAU",
  "names": []
}
